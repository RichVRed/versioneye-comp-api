require 'htmlentities'

module VulnerabilityHelpers


  def vuln_mapping vulnerability
    source = {
      :vendor => vulnerability.source
    }

    components = []
    vulnerability.affected_versions.each do |version|
      components << {:component_id => "#{vulnerability.language}:#{vulnerability.prod_key}:#{version}"}
    end

    properties = {}
    properties[:platform]  = vulnerability.platform  if !vulnerability.platform.to_s.empty?
    properties[:osvdb]     = vulnerability.osvdb     if !vulnerability.osvdb.to_s.empty?
    properties[:cve]       = vulnerability.cve       if !vulnerability.cve.to_s.empty?
    properties[:framework] = vulnerability.framework if !vulnerability.framework.to_s.empty?

    response = {
      :id          => vulnerability.ids,
      :name_id     => vulnerability.name_id,
      :links       => vulnerability.links,
      :summary     => vulnerability.summary,
      :severity    => vulnerability.cvss_v2,
      :description => vulnerability.description,
      :created     => vulnerability.created_at,
      :modified    => vulnerability.updated_at,
      :updated     => vulnerability.updated_at,
      :source      => source,
      :components  => components,
      :properties  => properties
    }
  end


end
